import React,{useState,Fragment, useEffect} from 'react'
import {Link} from 'react-router-dom'
import '../../assets/styles/CreateMenu.css'
import {connect} from 'react-redux';
import Popup from '../common/Popup'
import * as constants from '../../utilities/Constants'
import {clearTextField,clearRadio} from '../../utilities/CommonMethods'
import {addPerson} from '../../state/Actions'



const CreateMenu= (props)=> {
    (props.item==undefined)?(console.log("No No")):{}
    
    //Popup Message
    let content = ""
    const [formError,setFormError]=useState("")
    const [idError,setIDError]=useState("")
    const [isOpen,setIsOpen]=useState(false)
    const togglePopup = ()=>{
        setIsOpen(!isOpen)
    }

    //popup for success message
    const [isSuccess,setIsSuccess]=useState(false)
    const toggleSuccess = ()=>{
        setIsSuccess(!isSuccess)
    }
    let [initialSavings,setInitialSavings] = useState(false)
    let [initialRd,setInitialRd] = useState(false)
    const [name,setName]=useState("")
    const [id,setId]=useState("")
    const [gender, setGender]= useState("")
    const [priority,setPriority] = useState("0")
    let [savings,setSavings] = useState("No")
    let [rd,setRd] = useState("No")

    const rdHandler = ()=>{
        setInitialRd(initialRd=!initialRd)
        initialRd?setRd("Yes"):setRd("No")
        console.log("rddd",rd)
    }
    const savingsHandler = ()=>{
        setInitialSavings(initialSavings=!initialSavings)
        initialSavings?setSavings("Yes"):setSavings("No")
        console.log("save",initialSavings)
    }
    //Edit Section
    const [isEdit,setIsEdit]= useState(true)

    
    
    
    useEffect(()=>{
        console.log("PersonList from reducer",props.personList)
    },[])
    

    let duplicate_id=0;
   
 
    const submitHandler =(error)=>{

        idChecker(id)
        if(name==="" || id==="" || gender==="" || priority==='0'){
       
           setFormError("Enter All Fields");
           togglePopup()
       }
       
       else if(duplicate_id === 0){
            let data={name,id,gender,priority,savings,rd}
            props.addPerson(data)
            clearfield()
            setFormError("")
            setIDError("")
            toggleSuccess()
        }
     }   

    const idChecker = (c_id)=>{
        props.personList.forEach(person=>{
            if(person.id === c_id){
                duplicate_id=1;
                setIDError("ID Already Taken")
                togglePopup()
                
            }
      })

    }

    const clearfield = ()=>{
        console.log("Cleared")
    }

    
console.log("Rd",rd)

    return (
        <>
        {isOpen && <Popup
                    content={<>
                        <b id='logout-message'><li style={{fontSize:'12px', color:'red'}}>{idError}</li><li style={{fontSize:'12px'}}>{formError}</li></b> 
                         
                        <div className='logout-buttons' onHover={togglePopup}>
                    <button onClick={togglePopup} className='button-logout' id='red' style={{fontSize:'10px', width:'70px',height:'25px'}}>{constants.CREATE_PAGE.ADD_PERSON_ERROR_BUTTON}</button>
                        </div>
                        
                        </>}
                        handleClose={togglePopup}
                />}
        {isSuccess && <Popup
                    content={<>
                        <b id='logout-message'>{constants.CREATE_PAGE.ADD_PERSON_SUCCESS_MESSAGE}</b> 
                         
                        <div className='logout-buttons'>
                            <button onClick={toggleSuccess} className='button-logout'>Done</button>
                        </div>
                        
                        </>}
                        handleClose={togglePopup}
                />}        
        <div className='create'>
            <div className='createContent'>
                    {isEdit?(<p className='p'>Edit Person</p>):(<p className='p'>{constants.CREATE_PAGE.ADD_PERSON_HEADING}</p>)}
                
                    <div className='create-fields'>
                    <input type='text' placeholder='Name' required id='name' value={name} onChange={(e)=>setName(e.target.value)}></input>
                    <input type='number' placeholder='ID' required min='1' id='id' value={id} onChange={(e)=>setId(e.target.value)}></input>
                    <br/>
                    <label className='gender'>{constants.CREATE_PAGE.ADD_PERSON_GENDER} </label>
                    <label className='radio_label'><input type='radio' name='gender' value={gender} className='check' id='male' onChange={e=>setGender('Male')}></input>Male<span></span></label>
                    <br></br>
                   
                    <label className='radio_label radio2'><input type='radio' name='gender' value={gender} className='check' id='female' onChange={e=>setGender('Female')}></input>Female<span></span></label>
                    
                    <br/>
                    <div className='select'>
                        <select name='priority' id='select' onChange={e=>setPriority(e.target.value)}>
                            <option default value= '0'>Priority</option>
                            <option value='Basic'>Basic</option>
                            <option value='Advanced'>Advanced</option>
                        </select>   
                     </div>
                     <div className='checkbox'>
                     <input type="checkbox" id="savings" name="savings" value='savings' onClick={savingsHandler} />
                        <label for="savings">Savings</label>
                    <input type="checkbox" id="rd" name="rd" value='rd' onClick={rdHandler} />
                        <label for="rd">RD</label>

                    </div>
                
                    {isEdit?(<div className='edit-buttons'>
                                    <button type='submit' className='buttons' onClick={submitHandler}>Update</button>
                                    <button type='submit' className='buttons' style={{backgroundColor: "red"}} onClick={props.editHandler}>Cancel</button>
                             </div>):
                            (<button type='submit' className='buttons' onClick={submitHandler}>{constants.CREATE_PAGE.ADD_PERSON_SUBMIT_BUTTON}</button>)}
                </div>
                
                
            </div>
            
        </div>
        </>
    )
}


const mapStatetoProps = ({task1})=>{
    return {personList:task1.personList}
}

const mapDispatchtoProps = (dispatch)=>{
    return { addPerson : (data)=>{dispatch(addPerson(data))}}
}

export default connect(mapStatetoProps,mapDispatchtoProps)(CreateMenu)





 <div className="header-right">
                <div className='header-text'>
                    <p className='user-name'>{window.sessionStorage.getItem('Username').toUpperCase()}</p>
                </div>

                    <div class="dropdown">
                        <span class="dropbtn">&#8650;</span>
                        <div class="dropdown-content">
                            <a href="#" onClick={togglePopup}>Logout</a>
                            <Link to="/changepassword">Change Password</Link>
                        </div>
                    </div>
                    {isOpen && <Popup
                        content={<>
                            <b id='logout-message'>{constants.LOGOUT.LOGOUT_MESSAGE} </b>
                            <div className='logout-buttons'>
                                <button onClick={logoutHandler} className='button-logout' id='red'>{constants.LOGOUT.LOGOUT_CONFIRM}</button>
                                <button onClick={togglePopup} className='button-logout'>{constants.LOGOUT.LOGOUT_CANCEL}</button>
                            </div>
                            
                            </>}
                            handleClose={togglePopup}
                            />} 
            </div>